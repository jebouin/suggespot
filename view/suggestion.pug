include voteUI
include editUI

mixin photo(p, hidden)
  div.photo(draggable="false" pid=p.id style=hidden?"display: none":"")
    img.photoImg(src=p.path draggable="false")
    div.photoOverlay
      img.dragHandle(src="/view/svg/drag.svg" draggable="false")
      img.deleteButton(src="/view/svg/delete.svg" draggable="false")

mixin newPhoto()
  form#newPhoto(enctype="multipart/form-data" style="display: none")
    h3 New photo
    br
    input.big(type="file" name="photo" id="photo" accept=".png,.bmp,.jpeg,.jpg,.gif")
    button From an URL
    input.big(type="text" name="url" placeholder="Paste your URL" style="display: none" autocomplete="off")
    br
    span.error(style="visibility: hidden") Invalid file
    br
    label(for="photo") From your computer

mixin comment(c)
  div.comment
    + voteUI("1_" + c.id, c.score, c.dir, user)
    b
      if(c.author)
        a(href="/p/"+c.authorId) #{c.author}
      else
        | [deleted]
      | &nbsp;at #{c.time}
    | :&nbsp; #{c.content}
    | &nbsp;

mixin commentUI(sid)
  div.commentUI(style="display:none")
    form(action="/comment" method="POST")
      input(type="hidden" name="suggestionId" value=sid)
      input(type="hidden" name="parent")
      textarea.big(name="content" placeholder="Reply here" required)
      br
      input.big(type="submit" value="Send" title="Send your comment (Ctrl+Enter)")
      input.big(type="button" value="Cancel" onclick="cancelComment(event)")

- var isAuthor = user && user.id == author

doctype html
html
  include head
  body
    div#dark
    #body
      include header
      div.indented
        + voteUI("0_" + sid, score, voteDir, user)
        h2 #{title}
      div#suggestionBody
        div#tags
          | Tags:&nbsp;
          each t in tags
            button.tag(tid=t.tid)
              h3.tagText #{t.name}
          button.tag#newTag(style="display: none")
            h3 +New
          form(style="display: none")
            input(type="text" name="category" list="categories" autocomplete="off")
            datalist#categories
            input(type="submit" value="+")
          br
        div#photos
          div#photosGrid
            + photo({}, true)
            if photos && photos.length
              each p in photos
                + photo(p)
            if isAuthor
              + newPhoto()
          button#morePhotos(style="display: none") More
        p#descr #{descr}
        div#info
          span#author
            | By&nbsp;
            if author != null
              a(href="/p/"+author) #{authorName}
            else
              | [deleted]
          if isAuthor
            | &nbsp;
            button Edit
      br
      if published
        h2.indented Comments
        br
        form(action="/comment" method="POST")
          input(type="hidden" name="suggestionId" value=sid)
          textarea.big(name="content" placeholder="Comment this entry" required)
          input.big(type="submit" value="Send" title="Send your comment (Ctrl+Enter)")
        div#comments
          if comments && comments.length
            each c in comments
              div.commentThread
                + comment(c)
                div.replies(cid=c.id)
                  each child in c.children
                    + comment(child)
                  if user
                    a(href="javascript:void(0)" onclick="reply(event)") reply
          else if user
            p Be the first to comment!
        +commentUI(sid)
      else
        button.big#publishButton Publish
    script.
      var maximumPhotos = "#{maximumPhotos}";
    script(src="/libs/jquery.js")
    script(src="/view/scripts/suggestionScript.js")
    script(src="/view/scripts/voteUI.js")
