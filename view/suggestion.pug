include voteUI
include commentUI
include editUI

mixin newPhoto()
  form#newPhoto(enctype="multipart/form-data" style="display: none")
    h3 New photo
    input.big(type="file" name="photo" id="photo" accept=".png,.bmp,.jpeg,.jpg,.gif")
    button From an URL
    input.big(type="text" name="url" placeholder="Paste your URL" style="display: none")
    br
    label(for="photo") From your computer

mixin comment(c)
  div.comment
    + voteUI("1_" + c.id, c.score, c.dir, user)
    b
      a(href="/p/"+c.authorId) #{c.author}
      | &nbsp;at #{c.time}
    | :&nbsp; #{c.content}
    | &nbsp;

- var isAuthor = user && user.id == author

doctype html
html
  include head
  body
    #body
      include header
      div.indented
        + voteUI("0_" + sid, score, voteDir, user)
        h2 #{title}
      div#suggestionBody
        div#photos
          div#photosGrid
            if photos && photos.length
              each p in photos
                img(src=p.path draggable="false", pid=p.id)
            if isAuthor
              + newPhoto()
          button#morePhotos.off(style="display: none") More
        p#descr #{descr}
        div#info
          span#author
            | By&nbsp;
            a(href="/p/"+author) #{authorName}
            | &nbsp;
          if isAuthor
            button Edit
      br
      if published
        h2.indented Comments
        br
        form(action="/comment" method="POST")
          input(type="hidden" name="suggestionId" value=sid)
          textarea.big(name="content" placeholder="Comment this entry" required)
          input.big(type="submit" value="Send" title="Send your comment (Ctrl+Enter)")
        div#comments
          if comments && comments.length
            each c in comments
              div.commentThread
                + comment(c)
                div.replies(cid=c.id)
                  each child in c.children
                    + comment(child)
                  if user
                    a(href="javascript:void(0)" onclick="reply(event)") reply
          else if user
            p Be the first to comment!
        +commentUI(sid)
      else
        button.big#publishButton Publish
    script(src="/libs/jquery.js")
    script(src="/view/scripts/suggestionScript.js")
    script(src="/view/scripts/voteUI.js")
